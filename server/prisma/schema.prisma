generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int          @id @default(autoincrement())
  name       String
  email      String       @unique
  password   String
  role       String       // "learner" | "trainer" | "admin"
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  // Relations
  courses      Course[]       @relation("TrainerCourses")   // Trainer can create courses
  enrollments  Enrollment[]                                // Learner enrolls in courses
  ratings      Rating[]                                    // Ratings given by learner
  userSkills   UserSkill[]                                 // Skills a user is tracking
}

model Skill {
  id          Int         @id @default(autoincrement())
  name        String
  description String

  // Relations
  courses     Course[]    @relation("CourseSkills")         // A skill can have many courses
  userSkills  UserSkill[]                                  // Users tracking this skill
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model UserSkill {
  id        Int      @id @default(autoincrement())
  userId    Int
  skillId   Int
  status    String   // "pending" | "in_progress" | "completed"

  // Relations
  user      User     @relation(fields: [userId], references: [id])
  skill     Skill    @relation(fields: [skillId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Course {
  id          Int          @id @default(autoincrement())
  title       String
  description String
  price       Float

  // Relations
  trainer     User         @relation("TrainerCourses", fields: [trainerId], references: [id]) // Trainer creating the course
  trainerId   Int

  skill       Skill        @relation("CourseSkills", fields: [skillId], references: [id])     // Skill this course teaches
  skillId     Int

  enrollments Enrollment[]
  ratings     Rating[]

  createdAt   DateTime     @default(now())
}

model Enrollment {
  id         Int      @id @default(autoincrement())
  courseId   Int
  learnerId  Int
  status     String   @default("active") // "active" | "completed"

  // Relations
  course     Course   @relation(fields: [courseId], references: [id])
  learner    User     @relation(fields: [learnerId], references: [id])

  enrolledAt DateTime @default(now())
}

model Rating {
  id         Int      @id @default(autoincrement())
  courseId   Int
  learnerId  Int
  rating     Int
  comment    String?

  // Relations
  course     Course   @relation(fields: [courseId], references: [id])
  learner    User     @relation(fields: [learnerId], references: [id])

  createdAt  DateTime @default(now())
}
